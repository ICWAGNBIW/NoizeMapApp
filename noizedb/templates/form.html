{% extends 'base.html' %}
{% load static %}
{% block content %}
<form action="{% url 'noizedb:SubmitForm' %}" method="POST" name="MeasureForm" autocomplete="off"> 
    {% csrf_token %}
    <div class="d-flex justify-content-center">
        <div class="d-flex" style="width: 75%;margin-left: 5%;">
            <div class="col-md-5">
                <p class="field-name">Эквивалентный уровень шума:</p>
                <p class="field-name second">Максимальный уровень шума:</p>
                <p class="field-name second">Происхождение шума:</p>
                <p class="field-name second">Характер источника шума:</p>
            </div>
            <div class="col-md-7">
                <div class="d-flex  justify-content-center">
                    <input  class="field" name="Nlevel" id="noize-level" placeholder=" дБ">
                </div>
                <div class="d-flex  justify-content-center">
                    <input  class="field" name="MNlevel" placeholder=" дБ">
                </div>
                <div class="d-flex  justify-content-center">
                    <select class="field" name="From">
                        <option value="1">Автодорожный</option>
                        <option value="2">Воздушный</option>
                        <option value="3">Железнодорожный</option>
                        <option value="4">Промышленный</option>
                        <option value="5">Бытовой</option>
                    </select>
                </div>
                <div class="d-flex  justify-content-center">
                    <select class="field" name="Chark">
                        <option value="1">С импульсным шумом</option>
                        <option value="2">С преобалданием тонов</option>
                    </select>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
    <input name="location" id="location" type="hidden">
    </div>
    {% if place_list %}
        <div  class="map" id = "map" style = "width: 70%; height:580px; margin-left: 14%; margin-top: 3%; margin-bottom: 3%;"></div>
      <script>
        var MarkerIcon = L.Icon.extend({
            options: {
                customId: "",
                iconSize: [38, 95],
                iconAnchor: [22, 94],
                popupAnchor: [-3, -76]
            }
        }) 
        
        var gr = new MarkerIcon({iconUrl: '{% static 'attach/loc-gr.svg' %}'});
         // Creating map options
         var mapOptions = {
            center: [59.9386, 30.3141],
            zoom: 12
         }
         // Creating a map object
         var map = new L.map('map', mapOptions);
         
         // Creating a Layer object
         var layer = new L.TileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {
    	attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ',
	    maxZoom: 16
        });
         
         // Adding layer to the map
         map.addLayer(layer);
         
         // Creating a marker
        {% for coordinate in place_list %}
            var marker = L.marker([{{coordinate.lat}},{{coordinate.lon}}], {customId:{{coordinate.id}}, icon:gr}).addTo(map).bindPopup('Выбрать').on('click', markerOnClick);
        {% endfor %}

        let form = document.forms.MeasureForm
        let elem = form.elements.location
        function markerOnClick(e) {
            var customId = this.options.customId;
            elem.value = customId
        } 
         
      </script>

{% else %}
                    <div class="d-flex justify-content-center">
                        <h3>Что-то не так! Куда пропали координаты!?</h3>
                    </div>
{% endif %}
    <div class="d-flex justify-content-center">
    <button type="submit" class="log-btn">Внести</button>
    </div>
</form>


{% endblock content %}